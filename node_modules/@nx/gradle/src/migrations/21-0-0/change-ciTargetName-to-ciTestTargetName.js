"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.default = update;
const devkit_1 = require("@nx/devkit");
const has_gradle_plugin_1 = require("../../utils/has-gradle-plugin");
/* This function changes the @nx/gradle plugin option from ciTargetName to ciTestTargetName
 */
function update(tree) {
    const nxJson = (0, devkit_1.readNxJson)(tree);
    if (!nxJson) {
        return;
    }
    if (!(0, has_gradle_plugin_1.hasGradlePlugin)(tree)) {
        return;
    }
    let gradlePluginIndex = nxJson.plugins.findIndex((p) => typeof p === 'string' ? p === '@nx/gradle' : p.plugin === '@nx/gradle');
    let gradlePlugin = nxJson.plugins[gradlePluginIndex];
    if (typeof gradlePlugin === 'object' &&
        gradlePlugin.plugin === '@nx/gradle') {
        const ciTargetName = gradlePlugin.options?.['ciTargetName'];
        if (ciTargetName) {
            delete gradlePlugin.options?.['ciTargetName'];
            gradlePlugin.options['ciTestTargetName'] =
                ciTargetName;
        }
    }
    (0, devkit_1.updateNxJson)(tree, nxJson);
}
