"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.default = gradleExecutor;
const exec_gradle_1 = require("../../utils/exec-gradle");
const node_path_1 = require("node:path");
const run_commands_impl_1 = require("nx/src/executors/run-commands/run-commands.impl");
async function gradleExecutor(options, context) {
    let projectRoot = context.projectGraph.nodes[context.projectName]?.data?.root ?? context.root;
    let gradlewPath = (0, exec_gradle_1.findGradlewFile)((0, node_path_1.join)(projectRoot, 'project.json')); // find gradlew near project root
    gradlewPath = (0, node_path_1.join)(context.root, gradlewPath);
    let args = typeof options.args === 'string'
        ? options.args.trim().split(' ')
        : Array.isArray(options.args)
            ? options.args
            : [];
    if (options.testClassName) {
        args.push(`--tests`, options.testClassName);
    }
    try {
        const { success } = await (0, run_commands_impl_1.default)({
            command: `${gradlewPath} ${options.taskName}`,
            cwd: (0, node_path_1.dirname)(gradlewPath),
            args: args,
            __unparsed__: [],
        }, context);
        return { success };
    }
    catch (e) {
        return { success: false };
    }
}
